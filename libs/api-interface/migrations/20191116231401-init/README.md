# Migration `20191116231401-init`

This migration has been generated by Mitko Tschimev at 11/16/2019, 11:14:01 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "lift"."User" (
  "active" BOOLEAN NOT NULL DEFAULT false  ,
  "apiKey" TEXT NOT NULL DEFAULT ''  ,
  "createdAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  "email" TEXT NOT NULL DEFAULT ''  ,
  "forename" TEXT    ,
  "id" TEXT NOT NULL   ,
  "lastname" TEXT    ,
  "password" TEXT NOT NULL DEFAULT ''  ,
  "role" TEXT NOT NULL DEFAULT 'CUSTOMER'  ,
  "updatedAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  PRIMARY KEY ("id")
);

CREATE TABLE "lift"."Project" (
  "createdAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  "description" TEXT    ,
  "id" TEXT NOT NULL   ,
  "name" TEXT NOT NULL DEFAULT ''  ,
  "updatedAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  PRIMARY KEY ("id")
);

CREATE TABLE "lift"."Test" (
  "createdAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  "id" TEXT NOT NULL   ,
  "name" TEXT NOT NULL DEFAULT ''  ,
  "project" TEXT    REFERENCES "Project"(id) ON DELETE SET NULL,
  "updatedAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  PRIMARY KEY ("id")
);

CREATE TABLE "lift"."Variation" (
  "additionalData" TEXT    ,
  "browserName" TEXT NOT NULL DEFAULT ''  ,
  "createdAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  "deviceName" TEXT NOT NULL DEFAULT ''  ,
  "id" TEXT NOT NULL   ,
  "test" TEXT    REFERENCES "Test"(id) ON DELETE SET NULL,
  "updatedAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  PRIMARY KEY ("id")
);

CREATE TABLE "lift"."TestSession" (
  "autoBaseline" BOOLEAN NOT NULL DEFAULT false  ,
  "baselineForDiffRef" TEXT    REFERENCES "TestSession"(id) ON DELETE SET NULL,
  "baselineRef" TEXT    REFERENCES "Variation"(id) ON DELETE SET NULL,
  "createdAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  "diffImageKey" TEXT    ,
  "id" TEXT NOT NULL   ,
  "imageKey" TEXT    ,
  "isSameDimensions" BOOLEAN    ,
  "misMatchPercentage" REAL    ,
  "misMatchTolerance" REAL NOT NULL DEFAULT 0  ,
  "state" TEXT NOT NULL DEFAULT 'PENDING'  ,
  "stateChangedByUser" TEXT    REFERENCES "User"(id) ON DELETE SET NULL,
  "stateComment" TEXT    ,
  "updatedAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  "variation" TEXT    REFERENCES "Variation"(id) ON DELETE SET NULL,
  PRIMARY KEY ("id")
);

CREATE UNIQUE INDEX "lift"."User.email" ON "User"("email")

CREATE UNIQUE INDEX "lift"."User.apiKey" ON "User"("apiKey")
```

## Changes

```diff
diff --git datamodel.mdl datamodel.mdl
migration ..20191116231401-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,109 @@
+// Postgres
+// https://github.com/prisma/prisma2/blob/master/docs/core/connectors/postgresql.md
+// datasource db {
+//   provider = "postgresql"
+//   url      = env("VK_DATABASE")
+// }
+
+// SQLite
+datasource db {
+  provider = "sqlite"
+  url      = env("VK_DATABASE")
+}
+
+// Mysql
+// https://github.com/prisma/prisma2/blob/master/docs/core/connectors/mysql.md
+// datasource db {
+//   provider = "mysql"
+//   url      = env("VK_DATABASE")
+// }
+
+generator photon {
+  provider     = "photonjs"
+  binaryTarget = ["native", "linux-glibc-libssl1.0.2"]
+  output       = "../../node_modules/@generated/photonjs"
+}
+
+model User {
+  id        String   @id @default(cuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  email    String  @unique
+  password String
+  lastname String?
+  forename String?
+  active   Boolean @default(false)
+  role     Role    @default(CUSTOMER)
+  apiKey   String  @unique
+}
+
+model Project {
+  id        String   @id @default(cuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  name        String
+  description String?
+  tests       Test[]
+}
+
+model Test {
+  id        String   @id @default(cuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  name       String
+  project    Project
+  variations Variation[]
+}
+
+model Variation {
+  id        String   @id @default(cuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  browserName String
+  deviceName  String
+  test        Test
+
+  testSessions   TestSession[]
+  additionalData String?
+  baseline       TestSession?  @relation(name: "VariationBaseline")
+}
+
+model TestSession {
+  id        String   @id @default(cuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  diffImageKey       String?
+  imageKey           String?
+  misMatchPercentage Float?
+  misMatchTolerance  Float
+  isSameDimensions   Boolean?
+  variation          Variation
+  state              TestSessionState @default(PENDING)
+  stateChangedByUser User?
+  stateComment       String?
+  autoBaseline       Boolean          @default(false)
+
+  // baseline reference
+  baselineRef Variation? @relation(name: "VariationBaseline")
+
+  // reference to the diff
+  baselineForDiffRef TestSession? @relation(name: "DiffBaselineOnTestSession")
+  diffBaseline       TestSession? @relation(name: "DiffBaselineOnTestSession")
+}
+
+enum Role {
+  CUSTOMER
+  ADMIN
+}
+
+enum TestSessionState {
+  PENDING
+  UNRESOLVED
+  ACCEPTED
+  DECLINED
+}
```

## Photon Usage

You can use a specific Photon built for this migration (20191116231401-init)
in your `before` or `after` migration script like this:

```ts
import Photon from '@generated/photon/20191116231401-init'

const photon = new Photon()

async function main() {
  const result = await photon.users()
  console.dir(result, { depth: null })
}

main()

```
